
<!DOCTYPE html>
<html>
<head>
  <style type="text/css">
  svg {
    display: block;
    margin: 0 auto;
  }

  .land {
    fill: #ccc;
  }

  .county-boundary {
    fill: none;
    stroke: #fff;
    stroke-width: .5px;
  }

  .state-boundary {
    fill: none;
    stroke: #fff;
  }

</style>
</head>
<body>

  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  <script type="text/javascript">

  var width = 1000,
  height = 600;

  var projection = d3.geo.albersUsa()
  .scale(1200)
  .translate([width / 2, height / 2]);

  var path = d3.geo.path()
  .projection(projection);

  var svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height);

  var states = {};

  d3.tsv("us-state-names.tsv", function(tsv){
    tsv.forEach(function(d,i){
      states[d.id] = d;
    });
  });

  d3.json("us.json", function(error, us) {
    if (error) throw error;

    svg.insert("path", ".graticule")
    .datum(topojson.feature(us, us.objects.land))
    .attr("class", "land")
    .attr("d", path);

    svg.insert("path", ".graticule")
    .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
    .attr("class", "state-boundary")
    .attr("d", path)


    var sf = topojson.feature(us, us.objects.states).features;
    sf.filter(function(d, i) {
      var bounds = states[us.objects.states.geometries[i].id].bounds = path.bounds(d);
      states[us.objects.states.geometries[i].id].dx = bounds[1][0] - bounds[0][0];
      states[us.objects.states.geometries[i].id].dy = bounds[1][1] - bounds[0][1];
      states[us.objects.states.geometries[i].id].x = (bounds[0][0] + bounds[1][0]) / 2;
      states[us.objects.states.geometries[i].id].y = (bounds[0][1] + bounds[1][1]) / 2;
    });

    console.log(states);
  });


  d3.json("network.json", function (error, network) {
    if (error) throw error;


  });

  d3.select(self.frameElement).style("height", height + "px");

  // d3.csv("flights-airport.csv", function(flights) {
  //   var linksByOrigin = {},
  //   countByAirport = {},
  //   locationByAirport = {},
  //   positions = [];

  //   var arc = d3.geo.greatArc()
  //   .source(function(d) { return locationByAirport[d.source]; })
  //   .target(function(d) { return locationByAirport[d.target]; });

  //   flights.forEach(function(flight) {
  //     var origin = flight.origin,
  //     destination = flight.destination,
  //     links = linksByOrigin[origin] || (linksByOrigin[origin] = []);
  //     links.push({source: origin, target: destination});
  //     countByAirport[origin] = (countByAirport[origin] || 0) + 1;
  //     countByAirport[destination] = (countByAirport[destination] || 0) + 1;
  //   });

  //   d3.csv("airports.csv", function(airports) {

  //     airports = airports.filter(function(airport) {
  //       if (countByAirport[airport.iata]) {
  //         var location = [+airport.longitude, +airport.latitude];
  //         locationByAirport[airport.iata] = location;
  //         positions.push(projection(location));
  //         return true;
  //       }
  //     });

  //     var polygons = d3.geom.voronoi(positions);

  //     var g = cells.selectAll("g")
  //     .data(airports)
  //     .enter().append("svg:g");

  //     g.append("svg:path")
  //     .attr("class", "cell")
  //     .attr("d", function(d, i) { return "M" + polygons[i].join("L") + "Z"; })
  //     .on("mouseover", function(d, i) { d3.select("h2 span").text(d.name); });

  //     g.selectAll("path.arc")
  //     .data(function(d) { return linksByOrigin[d.iata] || []; })
  //     .enter().append("svg:path")
  //     .attr("class", "arc")
  //     .attr("d", function(d) { return path(arc(d)); });

  //     circles.selectAll("circle")
  //     .data(airports)
  //     .enter().append("svg:circle")
  //     .attr("cx", function(d, i) { return positions[i][0]; })
  //     .attr("cy", function(d, i) { return positions[i][1]; })
  //     .attr("r", function(d, i) { return Math.sqrt(countByAirport[d.iata]); })
  //     .sort(function(a, b) { return countByAirport[b.iata] - countByAirport[a.iata]; });
  //   });
  // });

</script>
</body>
</html>
